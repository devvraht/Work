<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drone Streamer</title>
<style>
body { margin:0; background:black; display:flex; justify-content:center; align-items:center; height:100vh; }
canvas { width:100vw; height:100vh; background:black; object-fit:contain; }
</style>
</head>
<body>
<canvas id="fullCanvas"></canvas>
<script>
const params = new URLSearchParams(window.location.search);
const droneID = params.get("droneID");
const canvas = document.getElementById("fullCanvas");
const ctx = canvas.getContext("2d");

let ws;
function connectWS() {
  ws = new WebSocket("ws://localhost:8080/view");

  ws.onmessage = (event)=>{
    const [id, base64] = event.data.split("|");
    if(id === droneID) {
      const img = new Image();
      img.src = "data:image/jpeg;base64," + base64;
      img.onload = ()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
      }
    }
  };

  ws.onclose = ()=>setTimeout(connectWS, 1000);
}
connectWS();
</script>
</body>
</html>
